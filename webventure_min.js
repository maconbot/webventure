function WebVenture(){function g(){if(U.isReady()){h.gameState=0;for(var a,s=1;a==void 0&&s<5;s++)a=U.getResByKind("APPL","MCV"+s);v.open(a);s=v.getIndStr(129,2);a=U.getRes(s);a!=void 0?(a=v.open(a),s=decodePPIC(v.get("PPIC",0)),v.close(a)):s=decodePack(U.getData(s));fa.remove();fa=void 0;pa=x.create("","plainDBox",!1,!1,0,0,512,342);pa.show();s.draw(pa.port,0,0);for(s=0;s<5;s++)ga.load(s,v.getIndStr(129,s+4));s=v.get("GNRL",128);ha=s.r16();ra=s.r16();ka=s.r16();ia=s.r16();sa=s.r16();s.r16();E={};
E.top=s.r16();E.left=s.r16();E.height=s.r16();E.width=s.r16();E.stepy=s.r16();E.stepx=s.r16();E.num=0;s.r16();s.r16();ta=Array(ia);for(a=0;a<ia;a++)ta[a]=s.r8();qa=Array(ia);for(a=0;a<ia;a++)qa[a]=s.r16();ua=Array(ia);for(a=0;a<ia;a++)ua[a]=s.r8();za=Array(ka);for(a=0;a<ka;a++)za[a]=s.r8();Aa=Array(ka);for(a=0;a<ka;a++)Aa[a]=s.r8();la=[];j();J=[];h.queue=[];h.soundQueue=[];h.textQueue=[];L=Array(ha*2);M.setHuff(v.get("GNRL",131));P=x.get(v.get("WIND",128));P.kind=9;P.addClass("commands");for(s=0;s<
ka;s++)Aa[s]&&P.add(D.get(v.get("CNTL",129+s)));H=x.get(v.get("WIND",129));H.kind=10;Z=x.get(v.get("WIND",130));Z.kind=11;N=$(document.createElement("div"));N.addClass("textEdit");Z.setCanvas(N);da=x.get(v.get("WIND",131));da.kind=12;da.refCon={id:0,x:0,y:0,children:[{id:1,top:0,left:0,width:0,height:0}]};O=x.get(v.get("WIND",132));O.kind=13;O.addClass("exits");for(s=128;s<=133;s++)va.get(v.get("MENU",s));va.addDA("Adjust Volume...");Z.setTitle(v.getIndStr(128,1));if(gameparts.length>1)Y=gameparts[1],
a=window.JSON.parse(window.localStorage.getItem(Y).toString()),V=a.gamedata,h.globals=a.globals,N.html(a.text),Z.setTitle(Y);else{a=U.getData(v.getString(133));V=Array(sa);h.globals=Array(ra);for(s=0;s<sa;s++){V[s]=Array(ha);for(var b=0;b<ha;b++)V[s][b]=a.r16()}for(s=0;s<ra;s++)h.globals[s]=a.r16()}d();if(Y=="")h.cmdReady=!0,h.selectedCtl=1,z.push(h.get(1,0));setTimeout(m,500)}else setTimeout(g,10)}function m(){x.close(pa);pa=void 0;va.show();P.show();da.show();h.updateWindow(da);O.show();Z.show();
H.show();h.gameState=1;N.scrollTop(1E4);h.set(h.get(1,0),6,1);h.gameChanged=!1;h.runMain()}function j(){h.selectedCtl=0;aa=void 0;z=[];G=0;I={h:0,v:0};M.input="";h.cmdReady=!1;wa=0}function d(){for(var a,s,b=0;b<ha*2;b++)L[b]=0;for(b=ha-1;b;b--)a=V[0][b],(s=L[a*2])&&(L[b*2+1]=s),L[a*2]=b}function b(a){a&&(a=l(a))&&x.bringToFront(a)}function a(a){if(la.indexOf(a)==-1){la.push(a);var s={};s.obj=a;s.parent=h.get(a,0);s.x=h.get(a,1);s.y=h.get(a,2);s.exitx=h.get(a,9);s.exity=h.get(a,10);s.hidden=h.get(a,
11);s.offscreen=h.get(a,3);s.invisible=h.get(a,4);h.queue.push({id:7,val:s})}}function c(){if(h.gameState==2){x.closeAll();var a=v.getString(131),s=U.getRes(a),b;if(s!=void 0){s=v.open(s);var c=v.get("PPIC",0);c!=void 0&&(b=decodePPIC(c));v.close(s)}b==void 0&&(b=decodePack(U.getData(a)));xa=x.get(v.get("WIND",133));xa.show();b.draw(xa.port,0,0);n();h.gameState=4}else if(h.gameState==3){q();var p=x.getAlert(v.get("ALRT",134));p.show();h.modalDialog=function(a){x.close(p);switch(a){case 1:f();break;
case 3:h.gameState=4;h.runMain();break;default:Ba()}}}}function n(){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";a.href="print.css";a.media="print";$("head").append(a);var s=v.get("GNRL",129);s.r16();a=s.r16();var b=s.r16(),c=s.r16(),p=s.r16()-b;s=s.r16()-c;x.getDialog(v.get("DLOG",135)).show();h.isPaused=!0;var e=D.create(c,b,s,p,4096,"",!0,0,0,0,4);xa.add(e);e.css("text-align","center");e.css("font-size",a+"px");e.css("line-height",p+"px");e.focus();h.modalDialog=function(a){switch(a){case 1:e.blur();
window.print();break;case 2:h.runMain()}}}function f(){for(var a=U.getData(v.getString(133)),s=0;s<sa;s++)for(var b=0;b<ha;b++)V[s][b]=a.r16();for(s=0;s<ra;s++)h.globals[s]=a.r16();r();d();Z.setTitle(v.getIndStr(128,1));N.html("");h.selectedCtl=1;z=[h.get(1,0)];h.gameState=1;h.set(h.get(1,0),6,1);ma=na=oa=h.gameChanged=!1;ba.reset();h.cmdReady=!0;h.runMain()}function i(){Y==""?e():(window.localStorage.setItem(Y,window.JSON.stringify({game:gamename,gamedata:V,globals:h.globals,text:N.html()})),Z.setTitle(Y),
h.gameChanged=!1,ja())}function e(){var a=x.createDialog("","dBox",!0,!1,104,79,304,184,void 0);a.add(D.create(218,132,70,18,0,"Save",!0,0,0,0,1));a.add(D.create(218,158,70,18,0,"Cancel",!0,0,0,0,2));a.add(D.create(14,136,183,16,4352,"Save as:",!0,0,0,0,3));a.add(D.create(17,157,177,16,4096,"",!0,0,0,0,7));a.add(D.create(14,29,183,98,4608,"",!0,0,0,0,8));a.kind=2;h.isPaused=!0;a.show();for(var s=a.getItem(8),b=void 0,c=0;c<window.localStorage.length;c++){var p=window.localStorage.key(c);if(p!=null&&
window.JSON.parse(window.localStorage.getItem(p).toString()).game==gamename){var e=$(document.createElement("div"));e.addClass("listitem");e.click(function(s){b&&b.removeClass("active");b=$(s.target);b.addClass("active");a.getItem(7).val(b.text())});e.text(p.toString());s.append(e)}}h.modalDialog=function(s){switch(s){case 1:Y=a.getItem(7).val();x.close(a);h.isPaused=!1;i();break;case 2:x.close(a),h.isPaused=!1,ja()}}}function r(){x.reset();E.num=0;h.queue=[];h.soundQueue=[];h.textQueue=[];la=[]}
function q(){for(aa&&aa.removeClass("active");J.length;)t(J.pop());j()}function t(a){var s=O.find(a);s&&(J.indexOf(a)!=-1?s.addClass("active"):s.removeClass("active"));a==h.get(1,0)&&(J.indexOf(a)!=-1?O.addClass("selected"):O.removeClass("selected"));h.updateWindow(h.getParentWin(a))}function l(a){switch(a){case 65532:return O;case 65533:return da;case 65534:return Z;case 65535:return P}return x.find(a)}function u(a,s){for(var b=[],c=L[a*2];c;)b.push(c),s||(b=b.concat(u(c,!1))),c=L[c*2+1];return b}
function y(a){if(!l(a))if(a==h.get(1,0)){K(a,H);h.updateWindow(H);o();var b=M.get(a);H.setTitle(M.capitalize(b))}else{var c={h:h.get(a,1),v:h.get(a,2)};h.getParentWin(a).localToGlobal(c);var p=A();b=M.get(a);var e=x.create(b,"zoomDoc",!1,!0,p.left,p.top,p.width,p.height);e.kind=14;e.scrollbars();K(a,e);e.refCon.updateScroll=!0;var d=$(document.createElement("div"));a=W.position();d.addClass("zoom");W.append(d);d.css("top",c.v+"px");d.css("left",c.h+"px");d.css("width","0px");d.css("height","0px");
d.animate({top:p.top+a.top+"px",left:p.left+a.left+"px",width:p.width+"px",height:p.height+"px"},500,"swing",function(){d.remove();e.show();h.updateWindow(e)})}}function p(a){var b=x.tryClose(l(a));if(b!=void 0&&(a=h.getParentWin(b.obj),a!=void 0)){var c=$(document.createElement("div"));c.addClass("zoom");W.append(c);c.css("top",b.top+"px");c.css("left",b.left+"px");c.css("width",b.width+"px");c.css("height",b.height+"px");b={h:h.get(b.obj,1),v:h.get(b.obj,2)};a.localToGlobal(b);c.animate({top:b.v+
"px",left:b.h+"px",width:"0px",height:"0px"},500,"swing",function(){c.remove();E.num--})}}function k(a,b,c){var p={},e={h:0,v:0};a.localToGlobal(e);p.minx=e.h;p.miny=e.v;p.maxx=e.h+a.port.width();p.maxy=e.v+a.port.height();var d=$(document.createElement("div"));d.addClass("lasso");W.append(d);d.css("top",b.pageY+"px");d.css("left",b.pageX+"px");d.css("width","0px");d.css("height","0px");$(document).mousemove(function(a){var c=Math.max(Math.min(b.pageX,a.pageX),p.minx),e=Math.max(Math.min(b.pageY,
a.pageY),p.miny),h=Math.min(Math.max(b.pageX,a.pageX),p.maxx);a=Math.min(Math.max(b.pageY,a.pageY),p.maxy);d.css("top",e+"px");d.css("left",c+"px");d.css("width",h-c+"px");d.css("height",a-e+"px")});$(document).mouseup(function(e){$(document).unbind("mousemove");$(document).unbind("mouseup");var f=Math.max(Math.min(b.pageX,e.pageX),p.minx),k=Math.max(Math.min(b.pageY,e.pageY),p.miny),n=Math.min(Math.max(b.pageX,e.pageX),p.maxx),i=Math.min(Math.max(b.pageY,e.pageY),p.maxy);d.remove();e={h:f,v:k};a.globalToLocal(e);
k={top:e.v,left:e.h,width:n-f,height:i-k};f=[];for(n=0;n<a.refCon.children.length;n++){var j=a.refCon.children[n].id;if(!h.get(j,4))k.left=e.h-h.get(j,1),k.top=e.v-h.get(j,2),w(j,k)&&f.push(j)}if(b.shiftkey){if(f.length==0){if(z.length==0||a!=h.getParentWin(z[0]))z.indexOf(a.refCon.id)!=-1?X(a.refCon.id):h.selectObj(a.refCon.id)}else for(;f.length;)j=f.shift(),z.indexOf(j)!=-1?X(j):h.selectObj(j);h.runMain()}else{if(f.length==0)j=a.refCon.id;else for(;f.length;)j=f.shift(),h.selectObj(j);h.handleObjectSelect(j,
a,b,c)}})}function A(){for(var a=E.left,b=E.top,c=0;c<E.num;c++){a+=E.stepx;b+=E.stepy;if(b>=330)b=E.top;if(a>=500)a=E.left}E.num++;return{top:b,left:a,width:E.width,height:E.height}}function K(a,b){var c=u(a,!0);b.refCon={id:a,x:0,y:0,updateScroll:!1,children:[]};for(var e=32767,p=32767,d=0;d<c.length;d++)if(c[d]!=1){var f={id:c[d],top:0,left:0,width:0,height:0};if(b!=H){var k=h.get(f,1),n=h.get(f,2);e>k&&(e=k);p>n&&(p=n)}b.refCon.children.push(f)}if(e!=32767)b.refCon.x=e;if(p!=32767)b.refCon.y=
p;if(b!=H)b.refCon.updateScroll=!0}function o(){O.killControls();for(var a=u(h.get(1,0),!0),b=0;b<a.length;b++)B(a[b])}function B(a){if(h.get(a,8)){var b=O.find(a);b&&O.remove(b);!h.get(a,11)&&h.get(a,0)==h.get(1,0)&&(b=D.get(v.get("CNTL",128)),b.data("refcon",a),D.move(b,h.get(a,9),h.get(a,10)),O.add(b))}}function F(){if(na){na=!1;if(ba.resume())return na=!0;return!1}if(ma){ma=!1;if(ba.resume())return ma=!0;h.updateScreen(!1)}for(;z.length;){var a=z.shift();if((h.gameState==0||h.gameState==1)&&Q(a)){if(ba.run(h.selectedCtl,
a,G,I))return ma=!0;h.updateScreen(!1)}}if(h.selectedCtl==1)h.gameChanged=!1;else if((h.gameState==0||h.gameState==1)&&ba.run(3,h.selectedCtl,G,I))return na=!0;return!1}function Q(a){if(!R(a))return!1;if(S()>=2&&G>0&&!R(G))return!1;if(h.selectedCtl!=5)return!0;if(!(h.get(a,3)==0&&h.get(a,4)==0&&h.get(a,5)==0))return!1;if(h.get(1,0)!=G)return!0;var b={top:0,left:0,width:H.port.width(),height:H.port.height()};b.top-=h.get(a,2)+I.v;b.left-=h.get(a,1)+I.h;return w(a,b)}function w(a,b){var c={top:0,left:0,
width:0,height:0},e;if(e=T.get(a*2+1)){c.width=e.width;c.height=e.height;if(T.sectRect(c,b,c))return e.intersect(c);return!1}if(e=T.get(a*2))return c.width=e.width,c.height=e.height,T.sectRect(c,b,c);return!1}function R(a){for(var b=h.get(1,0);a!=0&&a!=1&&a!=b;)a=h.get(a,0);return a}function S(){if(!h.selectedCtl)return 3E3;return za[h.selectedCtl-1]}function X(a){var b=z.indexOf(a);b!=-1&&z.splice(b,1);if((b=J.indexOf(a))!=-1)J.splice(b,1),t(a)}function ca(){var a=v.get(v.getIndStr(129,1),0),b=a.r8();
a=h.mac2ascii(a.read(b));var c=x.createDialog("","dBox",!0,!1,146,96,220,150,void 0);c.add(D.create(75,120,70,18,0,"Ok",!0,0,0,0,1));c.add(D.create(20,30,180,40,4352,a,!0,0,0,0,2));c.add(D.create(20,80,180,40,4352,"WebVenture <br /> &#169; 2010 Sean Kasun",!0,0,0,0,3));c.getItem(2).css("text-align","center");c.getItem(3).css("text-align","center");c.kind=2;h.isPaused=!0;c.show();h.modalDialog=function(){x.close(c);h.isPaused=!1}}function ea(){var a=x.createDialog("","dBox",!0,!1,146,96,220,120,void 0);
a.add(D.create(75,90,70,18,0,"Ok",!0,0,0,0,1));var b=h.setting("volume");b==null&&(b=50);a.add(D.create(55,55,110,13,4864,"",!0,b,0,100,2));a.add(D.create(20,25,180,20,4352,"Sound Volume",!0,0,0,0,3));a.getItem(3).css("text-align","center");a.kind=2;h.isPaused=!0;a.show();h.modalDialog=function(){var b=a.getItem(2).data("value"),c=new Date;c.setTime(c.getTime()+31536E6);document.cookie="webventure_volume="+escape(b)+"; expires="+c.toGMTString()+"; path=/";x.close(a);h.isPaused=!1}}function Ea(){if(h.gameChanged){var a=
h.mac2ascii(v.getIndStr(128,8)),b=x.getAlert(v.get("ALRT",131));h.isPaused=!0;b.param([a]);b.show();h.modalDialog=function(a){x.close(b);switch(a){case 1:ja=Ea;i();break;case 2:h.isPaused=!1;break;case 3:f()}}}else f()}function Fa(){if(h.gameChanged){var a=h.mac2ascii(v.getIndStr(128,9)),b=x.getAlert(v.get("ALRT",131));b.param([a]);b.show();h.isPaused=!0;h.modalDialog=function(a){x.close(b);switch(a){case 1:ja=Fa;i();break;case 2:h.isPaused=!1;break;case 3:Ba()}}}else Ba()}function Ba(){var a=x.createDialog("",
"dBox",!0,!1,82,71,348,200,void 0);a.add(D.create(256,138,80,18,0,"Open",!0,0,0,0,1));a.add(D.create(256,163,80,18,0,"Cancel",!0,0,0,0,3));a.add(D.create(12,39,218,146,4608,"",!0,0,0,0,7));a.kind=2;h.isPaused=!0;a.show();for(var b=a.getItem(7),c=void 0,e=0;e<window.localStorage.length;e++){var p=window.localStorage.key(e);if(p!=null&&window.JSON.parse(window.localStorage.getItem(p).toString()).game==gamename){var f=$(document.createElement("div"));f.addClass("listitem");f.click(function(a){c&&c.removeClass("active");
c=$(a.target);c.addClass("active")});f.text(p.toString());b.append(f)}}h.modalDialog=function(b){switch(b){case 1:if(c==void 0)break;Y=c.text();x.close(a);h.isPaused=!1;b=window.JSON.parse(window.localStorage.getItem(Y).toString());V=b.gamedata;h.globals=b.globals;r();d();Z.setTitle(Y);N.html(b.text);N.scrollTop(1E4);h.gameState=1;ma=na=oa=!1;z=[];h.selectedCtl=0;ba.reset();h.set(h.get(1,0),6,1);h.gameChanged=!1;h.runMain();break;case 3:x.close(a),h.isPaused=!1}}}function Ga(){if(h.gameChanged){var a=
h.mac2ascii(v.getIndStr(128,7)),b=x.getAlert(v.get("ALRT",131));b.param([a]);b.show();h.isPaused=!0;h.modalDialog=function(a){x.close(b);switch(a){case 1:ja=Ga;i();break;case 2:h.isPaused=!1;break;case 3:h.gameState=4,h.runMain()}}}else h.gameState=4,h.runMain()}function Ca(a){if(a!=G){var b;if(G>0&&(b=J.indexOf(G))!=-1&&z.indexOf(G)==-1)J.splice(b,1),t(G);G=a;J.indexOf(G)==-1&&(J.push(G),t(G));h.cmdReady=!0}}function Ja(a,b,c,e){var p=c.pageX,d=c.pageY,f={h:0,v:0},k=!1;C=void 0;e&&$(document).mousemove(function(c){if(C==
void 0){if(Math.abs(c.pageX-p)+Math.abs(c.pageY-d)<=7)return!1;k=!0;C=Ha(a);var e=h.getChildIdx(b.refCon.children,a);if(e)f.h=b.refCon.children[e-1].left,f.v=b.refCon.children[e-1].top;b.localToGlobal(f);C.css("top",f.v+"px");C.css("left",f.h+"px")}e=C.position();C.css("top",e.top+(c.pageY-d)+"px");C.css("left",e.left+(c.pageX-p)+"px");p=c.pageX;d=c.pageY;return!1});$(document).mouseup(function(c){var p;e&&($(document).unbind("mousemove"),C&&(p=C.position(),C.remove()));$(document).unbind("mouseup");
if(k)I.h=p.left,I.v=p.top,c=Ia(c.pageX,c.pageY),G=c.id,I.h-=f.h,I.v-=f.v,c.win!=b&&(b.localToGlobal(I),c.win&&c.win.globalToLocal(I)),h.selectedCtl=5,h.activateCommand(5),h.cmdReady=!0;if(!h.cmdReady&&(Ca(a),!h.selectedCtl))h.selectedCtl=4,h.activateCommand(4),h.cmdReady=!0;h.runMain()})}function Ka(a,b,c,e){var p=c.pageX,d=c.pageY,f={h:0,v:0},k=!1;C=void 0;e&&$(document).mousemove(function(c){if(C==void 0){if(Math.abs(c.pageX-p)+Math.abs(c.pageY-d)<=7)return!1;k=!0;C=Ha(a);var e=h.getChildIdx(b.refCon.children,
a);if(e)f.h=b.refCon.children[e-1].left,f.v=b.refCon.children[e-1].top;b.localToGlobal(f);C.css("top",f.v+"px");C.css("left",f.h+"px")}e=C.position();C.css("top",e.top+(c.pageY-d)+"px");C.css("left",e.left+(c.pageX-p)+"px");p=c.pageX;d=c.pageY;return!1});$(document).mouseup(function(a){wa=a.timeStamp;var c;e&&($(document).unbind("mousemove"),C&&(c=C.position(),C.remove()));$(document).unbind("mouseup");if(k)I.h=c.left,I.v=c.top,a=Ia(a.pageX,a.pageY),G=a.id,I.h-=f.h,I.v-=f.v,a.win!=b&&(b.localToGlobal(I),
a.win&&a.win.globalToLocal(I)),h.selectedCtl=5,h.activateCommand(5),h.cmdReady=!0;if(S()==1)h.cmdReady=!0;h.runMain()})}function La(a){W.append(C);var b={h:h.get(a,1),v:h.get(a,2)};h.getParentWin(a).localToGlobal(b);C.animate({top:b.v+"px",left:b.h+"px"},300,"swing",function(){C.remove()})}function Ha(a){var b=T.get(a*2);a=T.get(a*2+1);var c=b.width,e=b.height;if(a){if(c<a.width)c=a.width;if(e<a.height)e=a.height}var p=$(document.createElement("canvas"));p.addClass("proxy");p.attr("width",c);p.attr("height",
e);W.append(p);a?a.bic(p,0,0):T.fill(p,0);b.xor(p,0,0);return p}function Ia(a,b){var c=x.findWindow(a,b),e=0;if(c.win!=void 0)e=c.win.kind;if(c.id==3&&(e==14||e==10))c.id=c.win.refCon.id;else switch(e){case 9:c.id=-1;break;case 11:c.id=-2;break;case 12:c.id=-3;break;case 13:c.id=-4;break;default:switch(c.id){case 0:c.id=-5;break;case 1:c.id=-6;break;case 2:c.id=-7;break;case 3:c.id=-8;break;case 4:c.id=-9;break;case 5:c.id=-10;break;case 6:c.id=-11;break;default:c.id=-12}}return c}var h=this,W,x,
U,ga,M,v,ba,D,va,T,Da,fa,pa,xa,H,P,Z,da,O,N;this.gameState=0;this.gameChanged=!1;var ha,ra,ka,ia,sa,E,ta,qa,ua,za,Aa,la,J,z;this.textQueue=this.soundQueue=this.queue=void 0;var aa,G,I;this.cmdReady=!1;this.selectedCtl=void 0;var wa,L,Y="",V;this.globals=void 0;var oa=!1,na=this.isPaused=!1,ma=!1;this.init=function(){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";a.href="game.css";$("head").append(a);W=$(document.createElement("div"));W.addClass("screen");fa=$(document.createElement("img"));
fa.attr("src","images/start.png");fa.css("width","100%");fa.css("height","100%");W.append(fa);$("script").filter(function(){return this.src.match(/webventure_(min|full)\.js/)}).after(W);U=new FileManager(gamename);v=new ResourceManager(U);ga=new ObjectManager(U);M=new TextManager(ga,v);D=new ControlManager;x=new WindowManager(W,v,D);T=new GraphicManager(ga);Da=new SoundManager(ga);va=new MenuManager(W);ba=new Engine(ga,M,v,T);g()};this.get=function(a,b){var c,e=ta[b];if(e&128){var p=ga.get(0,a);if(p.length==
0)return 0;e&=127;c=(p.charCodeAt(e*2)&255)<<8;c|=p.charCodeAt(e*2+1)&255}else c=V[e][a];c&=qa[b];return U.neg16(c>>ua[b])};this.set=function(b,c,e){if(c==0){var p=e,d=V[0][b];if(p!=b){var f=d*2;for(d=L[f];d!=b;)f=d*2+1,d=L[f];L[f]=L[d*2+1];f=p*2;for(d=L[f];d&&d<=b;)f=d*2+1,d=L[f];L[b*2+1]=d;L[f]=b}}c<12&&a(b);p=ta[c];e<<=ua[c];e&=qa[c];V[p][b]=e|V[p][b]&~qa[c];h.gameChanged=!0};this.updateObject=function(a){var c;if(c=h.get(1,0)==a?H:l(a))b(a),h.runQueue(),h.updateWindow(c)};this.updateWindow=function(a){if(a!=
void 0&&a.refCon!=void 0&&(a==da||h.get(a.refCon.id,6)==1)){a==H?T.get(a.refCon.id*2).draw(H.port,0,0):T.fill(a.port,0);for(var b=0;b<a.refCon.children.length;b++){var c=h.drawObject(a.refCon.children[b].id,a,0);a.refCon.children[b].top=c.top;a.refCon.children[b].left=c.left;a.refCon.children[b].width=c.width;a.refCon.children[b].height=c.height}if(a.kind==14&&a.refCon.updateScroll==!0){b={top:0,left:0,right:0,bottom:0};a.refCon.updateScroll=!1;for(c=0;c<a.refCon.children.length;c++){var e=a.refCon.children[c];
if(b.right==b.left||b.bottom==b.top)b.top=e.top,b.left=e.left,b.bottom=e.top+e.height,b.right=e.left+e.width;else{b.top=Math.min(b.top,e.top);b.left=Math.min(b.left,e.left);var p=e.left+e.width;b.bottom=Math.max(b.bottom,e.top+e.height);b.right=Math.max(b.right,p)}}if(b.right==b.left||b.bottom==b.top)b.top=a.refCon.y,b.left=a.refCon.x,b.bottom=a.refCon.y,b.right=a.refCon.x;else{if(b.left>a.refCon.x)b.left=a.refCon.x;if(b.right<a.refCon.x)b.right=a.refCon.x;if(b.top>a.refCon.y)b.top=a.refCon.y;if(b.bottom<
a.refCon.y)b.bottom=a.refCon.y}a.setScrollBounds(b)}}};this.drawObject=function(a,b,c){var e=h.get(a,1),p=h.get(a,2),d=h.get(a,3);if(c||!d||!h.get(a,4)){var f=1;d||c?f=0:J.indexOf(a)!=-1&&(f=2);a=T.draw(a,e-b.refCon.x,p-b.refCon.y,b.port,f);a.top+=b.refCon.y;a.left+=b.refCon.x;return a}return{top:0,left:0,width:0,height:0}};this.runMain=function(){if(h.gameState==4)window.location="index.html";else{oa||h.updateScreen(!1);if(h.cmdReady||oa){oa=!1;if(F()){oa=!0;h.isPaused=!0;return}h.isPaused=!1;h.updateScreen(!1);
q()}(h.gameState==2||h.gameState==3)&&c()}};this.updateScreen=function(a){h.runQueue();h.printTexts();return h.playSounds(a)};this.runQueue=function(){for(;h.queue.length;){for(var c,e=0,d=0;d<h.queue.length;d++)if(h.queue[d].id>e)e=h.queue[d].id,c=d;e=h.queue.splice(c,1)[0];switch(e.id){case 2:b(e.val);break;case 3:y(e.val);break;case 4:p(e.val);break;case 7:a:{d=e.val;var f=!1;e=d.obj;var k=la.indexOf(e);k!=-1&&la.splice(k,1);if(e==1)d.parent!=h.get(e,0)&&h.queue.push({id:12}),(d.offscreen!=h.get(e,
3)||d.invisible!=h.get(e,4))&&h.updateWindow(h.getParentWin(e));else if(d.parent!=h.get(e,0)||d.x!=h.get(e,1)||d.y!=h.get(e,2)){if(k=l(d.parent)){f=k;if(f.refCon!=void 0&&(k=h.getChildIdx(f.refCon.children,e),k!=0))f.refCon.children.splice(k-1,1),f.refCon.updateScroll=!0,h.updateWindow(f);f=!0}if(k=h.getParentWin(e)){f=k;if(f.refCon!=void 0){k=void 0;for(k=0;k<f.refCon.children.length&&e>f.refCon.children[k].id;k++);if(k==f.refCon.children.length||e!=f.refCon.children[k].id)f.refCon.children.splice(k,
0,{id:e,top:0,left:0,width:0,height:0}),f.refCon.updateScroll=!0,h.updateWindow(f)}f=!0}}else(d.offscreen!=h.get(e,3)||d.invisible!=h.get(e,4))&&h.updateWindow(h.getParentWin(e));h.get(e,8)&&(f||d.hidden!=h.get(e,11)||d.exitx!=h.get(e,9)||d.exity!=h.get(e,10))&&B(e);d=l(e);f=e;for(k=h.get(1,0);f!=k;){if(f==0||!h.get(f,6))break;f=h.get(f,0)}if(f==k){if(d)break a;h.queue.push({id:3,val:e})}else{if(!d)break a;h.queue.push({id:4,val:e})}e=u(e,!0);for(k=0;k<e.length;k++)a(e[k])}break;case 8:e=e.val;f=
l(e.from);(d=k=l(e.to))||(d=f);if(d)f=M.get(e.to),d.setTitle(f),K(e.to,d),d.refCon.updateScroll=!0,h.updateWindow(d);break;case 12:h.set(H.refCon.id,6,0);h.set(h.get(1,0),6,1);break;case 13:for(;J.length;)t(J.pop());break;case 14:La(e.val)}}};this.playSounds=function(a){for(var b=0;h.soundQueue.length;){var c=h.soundQueue.splice(0,1)[0];switch(c.id){case 1:Da.play(c.val);break;case 2:b=Da.play(c.val)}}if(a&&b)return setTimeout(h.runMain,b*1E3),!0;return!1};this.printTexts=function(){for(;h.textQueue.length;){var a=
h.textQueue.splice(0,1)[0];switch(a.id){case 1:N.append(a.val);N.scrollTop(1E4);h.gameChanged=!0;break;case 2:N.append("<br/>");N.scrollTop(1E4);h.gameChanged=!0;break;case 3:M.source=a.val[1],M.target=a.val[0],N.append(M.get(a.val[2])),N.scrollTop(1E4),h.gameChanged=!0}}};this.invertmain=function(){H.invert()};this.revertmain=function(){H.invert();h.runMain()};this.getParentWin=function(a){if(a==1)return da;if(a=h.get(a,0))return l(a)};this.getFamily=function(a,b){return[a].concat(u(a,b))};this.getChildIdx=
function(a,b){var c;for(c=0;c<a.length&&a[c].id!=b;c++);if(c==a.length)return 0;return c+1};this.unselectall=function(){for(;z.length;)X(z.shift())};this.selectObj=function(a){z.length&&h.getParentWin(a)!=h.getParentWin(z[0])&&h.unselectall();z.indexOf(a)==-1&&z.push(a);J.indexOf(a)==-1&&(J.push(a),t(a))};this.activateCommand=function(a){a=P.find(a);a!=aa&&(aa&&aa.removeClass("active"),(aa=a)&&a.addClass("active"))};var ja=void 0;this.menuSelect=function(a,b){switch(a){case 128:switch(b){case 1:ca();
break;case 3:ea()}break;case 129:switch(b){case 1:Ea();break;case 3:Fa();break;case 4:ja=function(){};i();break;case 5:ja=function(){};e();break;case 7:Ga()}}};this.buttonClicked=function(a,b){var c=a.data("win");if(c.kind==2)return h.modalDialog(a.data("refcon"));if(c==O)h.isPaused||h.handleObjectSelect(a.data("refcon"),O,b,!1);else if(a.data("refcon")==0)P.remove(ya),P.showControls(),h.runMain();else if(!h.isPaused){aa&&a!=aa&&aa.removeClass("active");h.selectedCtl=a.data("refcon");h.activateCommand(h.selectedCtl);
switch(S()){case 0:h.cmdReady=!0;break;case 1:h.cmdReady=z.length!=0;break;case 2:if(G>0)h.cmdReady=!0}h.runMain()}};this.handleObjectSelect=function(a,b,c,e){b==O&&(b=H);if(c.shiftKey)if(a)z.indexOf(a)!=-1?X(a):h.selectObj(a),h.runMain();else if(b.kind==14)k(b,c,e);else{if(z.length==0||b!=h.getParentWin(z[0]))z.indexOf(b.refCon.id)!=-1?X(b.refCon.id):h.selectObj(b.refCon.id);h.runMain()}else if(h.selectedCtl&&z.length&&S()>1)a?Ca(a):Ca(b.refCon.id),h.runMain();else{if(!a)h.unselectall(),b.kind==
14?k(b,c,e):a=b.refCon.id;if(a){var p;c.timeStamp-wa<=300?(wa=0,p=!0):p=!1;p?(z.indexOf(a)==-1&&h.unselectall(),h.selectObj(a),Ja(a,b,c,e)):(z.indexOf(a)==-1&&h.unselectall(),h.selectObj(a),Ka(a,b,c,e))}}};var C=void 0;this.objHit=function(a,b){var c=0,e;if(e=!h.get(b.id,4))e=a.h>=b.left&&a.v>=b.top&&a.h<b.left+b.width&&a.v<b.top+b.height?!0:!1;if(e)if(e=T.get(b.id*2+1)){if(e.hit(a.h-b.left,a.v-b.top))c=b.id}else c=b.id;return c};var ya;this.clickToContinue=function(){var a=P.port.width(),b=P.port.height();
ya=D.create(4,4,a-8,b-8,2048,"Click to continue",!0,0,0,0,0);ya.addClass("ctc");P.hideControls();P.add(ya)};this.textEntry=function(a,b,c){M.target=c;M.source=b;var e=x.getDialog(v.get("DLOG",132));e.param([M.get(a)]);e.show();h.modalDialog=function(a){M.input=e.getItem(3).val();a!=2?ba.push(65535):ba.push(0);x.close(e);h.runMain()}};this.mac2ascii=function(a){for(var b="",c=0;c<a.length;c++)switch(a.charCodeAt(c)){case 13:b+="<br />";break;case 63368:b+="&#224;";break;case 63374:b+="&#233;";break;
case 63401:b+="&#169;";break;case 63433:b+="...";break;case 63441:b+="&#8212;";break;default:b+=a.charAt(c)}return b};this.setting=function(a){var b=document.cookie.split(";");a="webventure_"+a+"=";for(var c=0;c<b.length;c++){for(var e=b[c];e.charAt(0)==" ";)e=e.substring(1,e.length);if(e.indexOf(a)==0)return unescape(e.substring(a.length,e.length))}return null}}var webventure=new WebVenture;function Win(g,m,j,d,b,a,c,n){function f(a,b){var c=a,e=b;n.bringToFront(o);$(document).mousemove(function(a){var b=w.position();w.css("top",b.top+(a.pageY-e)+"px");w.css("left",b.left+(a.pageX-c)+"px");c=a.pageX;e=a.pageY});$(document).mouseup(function(a){$(document).unbind("mousemove");$(document).unbind("mouseup");var b=w.position();w.css("top",b.top+(a.pageY-e)+"px");w.css("left",b.left+(a.pageX-c)+"px")})}function i(a,b){var c={h:a,v:b},e=0,p=o.refCon.children.length;for(o.globalToLocal(c);p>
0&&e==0;)p--,e=webventure.objHit(c,o.refCon.children[p]);return e}function e(c,p,d){c.refCon.x+=p;c.refCon.y+=d;var f=k.data("min"),n=k.data("max");if(c.refCon.x<f)c.refCon.x=f;if(c.refCon.x>n-b+15)c.refCon.x=n-b+15;f=A.data("min");n=A.data("max");if(c.refCon.y<f)c.refCon.y=f;if(c.refCon.y>n-a+15)c.refCon.y=n-a+15;c.refCon.updateScroll=!0;webventure.updateWindow(o);var j=setTimeout(function(){e(c,p,d)},50);$(document).mouseup(function(){$(document).unbind("mouseup");clearTimeout(j)})}function r(c,
e){var p=c;$(document).mousemove(function(c){if(e){o.refCon.x+=c.pageX-p;p=c.pageX;c=k.data("min");var d=k.data("max");if(o.refCon.x<c)o.refCon.x=c;if(o.refCon.x>d-b+15)o.refCon.x=d-b+15}else{o.refCon.y+=c.pageY-p;p=c.pageY;c=A.data("min");d=A.data("max");if(o.refCon.y<c)o.refCon.y=c;if(o.refCon.y>d-a+15)o.refCon.y=d-a+15}o.refCon.updateScroll=!0;webventure.updateWindow(o)});$(document).mouseup(function(){$(document).unbind("mouseup");$(document).unbind("mousemove")})}var q=void 0,t=void 0,l=void 0,
u=void 0,y=void 0,p=void 0,k=void 0,A=void 0,K=void 0,o=this,B=[],F=void 0,Q=g=="zoomDoc",w=$(document.createElement("div"));w.addClass(g);if(g!="plainDBox"&&g!="altDBox"&&g!="dBox"){var R="<span></span>";F=$(document.createElement("div"));F.addClass("title");F.mousedown(function(a){webventure.isPaused||f(a.pageX,a.pageY);return!1});m&&(R='<div class="close"></div>'+R);Q&&(R+='<div class="resize"></div>');F.html(R);m&&(R=F.children("div.close"),R.mousedown(function(){return!1}),R.click(function(){if(!webventure.isPaused){if(o.kind==
14)webventure.unselectall(),webventure.selectObj(o.refCon.id),webventure.selectedCtl=2,webventure.activateCommand(2),webventure.cmdReady=!0;webventure.runMain()}return!1}));Q&&(R=F.children("div.resize"),R.mousedown(function(){return!1}),R.click(function(){return!1}));w.append(F)}this.port=$(document.createElement("canvas"));this.port.mousedown(function(a){if(!webventure.isPaused)switch(n.bringToFront(o),o.kind){case 9:f(a.pageX,a.pageY);break;case 10:case 14:var b=i(a.pageX,a.pageY),c=!1;b&&!webventure.get(b,
3)&&(c=!0);webventure.handleObjectSelect(b,o,a,c);break;case 12:b=i(a.pageX,a.pageY);b==1?webventure.handleObjectSelect(b,o,a,!1):f(a.pageX,a.pageY);break;case 13:webventure.handleObjectSelect(webventure.get(1,0),o,a,!1)}return!1});this.port.attr("width",b);this.port.attr("height",a);w.append(o.port);var S=d,X=a,ca=j,ea=b;F!=void 0&&(S-=17,X+=18);g=="dBox"&&(S-=2,ca-=2,ea+=2,X+=2);w.css("top",S+"px");w.css("left",ca+"px");w.css("width",ea+"px");w.css("height",X+"px");c.append(w);this.show=function(){w.show()};
this.hide=function(){w.hide()};this.setTitle=function(a){if(F!=void 0){var c=F.children("span");c.html("");if(a=="")c.hide();else{var e=w.css("display")=="none";w.show();c.css({position:"absolute",visibility:"hidden",display:"block"});var p=b;m&&(p-=30);Q&&(p-=30);for(var d=0;d<a.length;d++)if(c.append(a.substring(d,d+1)),c.width()>p){c.html(a.substring(0,d-1));break}c.css({position:"",visibility:"",display:""});e&&w.hide()}}};this.setCanvas=function(c){o.port.remove();c.css("top","0px");c.css("left",
"0px");c.css("width",b+"px");c.css("height",a+"px");w.append(c)};this.addClass=function(a){w.addClass(a)};this.removeClass=function(a){w.removeClass(a)};this.add=function(a){if(F!=void 0){var b=parseInt(a.css("top"),10);a.css("top",b+17+"px")}w.append(a);a.data("win",o);B.unshift(a)};this.remove=function(a){var b=B.indexOf(a);b!=-1&&B.splice(b,1);a.remove()};this.find=function(a){for(var b=0;b<B.length;b++)if(B[b].data("refcon")==a)return B[b]};this.killControls=function(){for(var a=0;a<B.length;a++)B[a].remove();
B=[]};this.hideControls=function(){for(var a=0;a<B.length;a++)B[a].hide()};this.showControls=function(){for(var a=0;a<B.length;a++)B[a].show()};this.close=function(){w.remove()};this.globalToLocal=function(a){var b=w.position();a.h-=b.left;a.v-=b.top;b=o.port.position();a.h-=b.left;a.v-=b.top;a.h+=o.refCon.x;a.v+=o.refCon.y};this.localToGlobal=function(a){var b=w.position();a.h+=b.left;a.v+=b.top;b=o.port.position();a.h+=b.left;a.v+=b.top;a.h-=o.refCon.x;a.v-=o.refCon.y};this.hit=function(a,b){var c=
w.position();if(a>=c.left&&a<c.left+w.width()&&b>=c.top&&b<c.top+w.height()){a-=c.left;b-=c.top;c=o.port.position();if(a>=c.left&&a<c.left+o.port.width()&&b>=c.top&&b<c.top+o.port.height())return{id:3,win:o};return{id:4,win:o}}};this.invert=function(){var a=o.port.get(0).getContext("2d"),b=o.port.width(),c=o.port.height();b=a.getImageData(0,0,b,c);for(c=0;c<b.height;c++)for(var e=c*b.width*4,p=0;p<b.width;p++)b.data[e++]^=255,b.data[e++]^=255,b.data[e++]^=255,b.data[e++]=255;a.putImageData(b,0,0)};
this.param=function(a){for(var b=0;b<B.length;b++){var c=B[b].text().indexOf("^");if(c>=0){var e=B[b].text().substr(0,c),p=B[b].text().substr(c+1,1);e+=a[parseInt(p,10)];e+=B[b].text().substr(c+2);B[b].text(e)}}};this.getItem=function(a){for(var b=0;b<B.length;b++)if(B[b].data("refcon")==a)return B[b]};this.scrollbars=function(){o.port.attr("width",b-15);o.port.attr("height",a-15);q=$(document.createElement("div"));q.addClass("hscroll");q.css("top",18+a-15+"px");q.css("left","0px");q.css("width",
b-15+"px");q.css("height","14px");q.mousedown(function(a){n.bringToFront(o);var b=k.position().left+w.position().left;a.pageX<b?e(o,-20,0):e(o,20,0);return!1});y=$(document.createElement("div"));y.addClass("leftarrow");y.css("top","0px");y.css("left","0px");y.css("width","14px");y.css("height","14px");y.mousedown(function(){e(o,-5,0);return!1});q.append(y);p=$(document.createElement("div"));p.addClass("rightarrow");p.css("top","0px");p.css("left",b-30+"px");p.css("width","14px");p.css("height","14px");
p.mousedown(function(){e(o,5,0);return!1});q.append(p);k=$(document.createElement("div"));k.addClass("slider");k.css("top","0px");k.css("left","15px");k.css("width","30px");k.css("height","12px");k.mousedown(function(a){r(a.pageX,!0);return!1});q.append(k);w.append(q);t=$(document.createElement("div"));t.addClass("vscroll");t.css("top","17px");t.css("left",b-15+"px");t.css("width","14px");t.css("height",a-15+"px");t.mousedown(function(a){n.bringToFront(o);var b=A.position().top+w.position().top;a.pageY<
b?e(o,0,-20):e(o,0,20);return!1});l=$(document.createElement("div"));l.addClass("uparrow");l.css("top","0px");l.css("left","0px");l.css("width","14px");l.css("height","14px");l.mousedown(function(){e(o,0,-5);return!1});t.append(l);u=$(document.createElement("div"));u.addClass("downarrow");u.css("top",a-30+"px");u.css("left","0px");u.css("width","14px");u.css("height","14px");u.mousedown(function(){e(o,0,5);return!1});t.append(u);A=$(document.createElement("div"));A.addClass("slider");A.css("top",
"15px");A.css("left","0px");A.css("width","12px");A.css("height","30px");A.mousedown(function(a){r(a.pageY,!1);return!1});t.append(A);w.append(t);K=$(document.createElement("div"));K.addClass("grow");K.css("top",18+a-15+"px");K.css("left",b-15+"px");K.css("width","14px");K.css("height","14px");K.mousedown(function(a){n.bringToFront(o);var b=$(document.createElement("div"));b.addClass("resizeProxy");c.append(b);var e=w.position();b.css("top",e.top+"px");b.css("left",e.left+"px");var p=ca+ea,d=S+X;
b.css("width",p-ca+"px");b.css("height",d-S+"px");var f=a.pageX,k=a.pageY;$(document).mousemove(function(a){var c=p+(a.pageX-f),e=d+(a.pageY-k);if(c>ca+100)p=c,b.css("width",p-ca+"px"),f=a.pageX;if(e>S+100)d=e,b.css("height",d-S+"px"),k=a.pageY});$(document).mouseup(function(){$(document).unbind("mousemove");$(document).unbind("mouseup");b.remove();o.resize(p-ca,d-S)});return!1});w.append(K)};this.setScrollBounds=function(c){if(c.left>o.refCon.x)c.left=o.refCon.x;if(c.right<o.refCon.x+b-15)c.right=
o.refCon.x+b-15;if(c.top>o.refCon.y)c.top=o.refCon.y;if(c.bottom<o.refCon.y+a-15)c.bottom=o.refCon.y+a-15;k.data("min",c.left);k.data("max",c.right);A.data("min",c.top);A.data("max",c.bottom);c=k.data("min");var e=k.data("max");if(c<e){var p=b-15,d=(o.refCon.x-c)*(b-45)/(e-c)|0;c=p*(b-45)/(e-c)|0;c>b-45-d&&(c=b-45-d);k.css("left",d+15+"px");k.css("width",c-2+"px")}else k.css("left","15px"),k.css("width",b-47+"px");c=A.data("min");e=A.data("max");c<e?(d=o.refCon.y-c,p=a-15,d=d*(a-45)/(e-c)|0,c=p*(a-
45)/(e-c)|0,c>a-45-d&&(c=a-45-d),A.css("top",d+15+"px"),A.css("height",c-2+"px")):(A.css("top","15px"),A.css("height",a-47+"px"))};this.resize=function(c,e){ea=c;X=e;a=e-18;b=ea;w.css("width",ea+"px");w.css("height",X+"px");q.css("top",18+a-15+"px");q.css("width",b-15+"px");p.css("left",b-30+"px");t.css("left",b-15+"px");t.css("height",a-15+"px");u.css("top",a-30+"px");K.css("top",18+a-15+"px");K.css("left",b-15+"px");o.port.attr("width",b);o.port.attr("height",a);o.refCon.updateScroll=!0;webventure.updateWindow(o)}}
function Dialog(g,m,j,d,b,a,c,n,f,i){var e=new Win(g,m,j,d,b,a,n,f);e.kind=2;this.show=function(){e.show()};this.hide=function(){e.hide()};this.close=function(){e.close()};this.setTitle=function(a){e.setTitle(a)};this.param=function(a){e.param(a)};this.getItem=function(a){return e.getItem(a)};this.add=function(a){e.add(a)};this.addClass=function(a){e.addClass(a)};this.removeClass=function(a){e.removeClass(a)};if(c!=void 0){g=c.r16()+1;for(m=0;m<g;m++){c.r32();j=c.r16();d=c.r16();b=c.r16()-j;a=c.r16()-
d;n=c.r8();f=c.r8();var r="";f>0&&(r=webventure.mac2ascii(c.read(f)));f&1&&c.r8();switch(n&127){case 4:j=i.create(d,j,a,b,0,r,!0,0,0,0,m+1);e.add(j);break;case 8:j=i.create(d,j,a,b,4352,r,!0,0,0,0,m+1);e.add(j);break;case 16:j=i.create(d,j,a,b,4096,r,!0,0,0,0,m+1);e.add(j);break;default:throw"Unknown DITL: "+(n&127);}}}}
function WindowManager(g,m,j){var d=this,b=[];this.create=function(a,b,n,f,j,e,r,q){var m=g.position();j+=m.left;e+=m.top;b=new Win(b,f,j,e,r,q,g,d);n==!1&&b.hide();b.setTitle(a);d.bringToFront(b);return b};this.createDialog=function(a,b,n,f,i,e,r,q,m){var l=g.position();i+=l.left;e+=l.top;b=new Dialog(b,f,i,e,r,q,m,g,d,j);n==!1&&b.hide();b.setTitle(a);d.bringToFront(b);return b};this.get=function(a){var b=a.r16(),n=a.r16(),f=a.r16()-b,j=a.r16()-n,e="";switch(a.r16()){case 0:e="document";break;case 1:e=
"dBox";break;case 2:e="plainDBox";break;case 3:e="altDBox";break;case 4:e="noGrowDoc";break;case 5:e="movableDBox";break;case 8:e="zoomDoc";break;case 12:e="zoomNoGrow";break;case 16:e="rDoc16";break;case 18:e="rDoc4";break;case 20:e="rDoc6";break;case 22:e="rDoc10"}var r=a.r16()!=0,q=a.r16()!=0;a.r32();var g=a.r8(),l="";g!=1&&(l=webventure.mac2ascii(a.read(g)));return d.create(l,e,r,q,n,b,j,f)};this.getDialog=function(a){var b=a.r16(),n=a.r16(),f=a.r16()-b,j=a.r16()-n,e="";switch(a.r16()){case 0:e=
"document";break;case 1:e="dBox";break;case 2:e="plainDBox";break;case 3:e="altDBox";break;case 4:e="noGrowDoc";break;case 5:e="movableDBox";break;case 8:e="zoomDoc";break;case 12:e="zoomNoGrow";break;case 16:e="rDoc16";break;case 18:e="rDoc4";break;case 20:e="rDoc6";break;case 22:e="rDoc10"}var r=a.r8()!=0;a.r8();var q=a.r8()!=0;a.r8();a.r32();var g=a.r16(),l=a.r8(),u="";l!=1&&(u=webventure.mac2ascii(a.read(l)));a=m.get("DITL",g);return d.createDialog(u,e,r,q,n,b,j,f,a)};this.getAlert=function(a){var b=
a.r16(),n=a.r16(),f=a.r16()-b,j=a.r16()-n;a=a.r16();a=m.get("DITL",a);return d.createDialog("","dBox",!0,!1,n,b,j,f,a)};this.close=function(a){for(var c=0;c<b.length;c++)if(b[c]==a){a.close();b.splice(c,1);break}b.length&&d.bringToFront(b[0])};this.tryClose=function(a){if(a!=void 0){var b=a.refCon.id;if(a.kind==10)a.refCon={},a.setTitle("");else{var n={v:0,h:0},f={v:a.port.height(),h:a.port.width()};a.localToGlobal(n);a.localToGlobal(f);a.refCon={};d.close(a);return{obj:b,top:n.v,left:n.h,width:f.h-
n.h,height:f.v-n.v}}}};this.find=function(a){for(var c=0;c<b.length;c++)if((b[c].kind==10||b[c].kind==14)&&b[c].refCon!=void 0&&b[c].refCon.id==a)return b[c]};this.bringToFront=function(a){if(b[0]!=a){b[0]!=void 0&&b[0].removeClass("active");for(var c=0;c<b.length;c++)b[c]==a&&b.splice(c,1);b.unshift(a)}a.addClass("active")};this.findWindow=function(a,c){var d=g.position();if(c>=d.top&&c<d.top+20&&a>=d.left&&a<d.left+g.width())return{id:1,win:void 0};for(d=0;d<b.length;d++){var f=b[d].hit(a,c);if(f!=
void 0)return f}return{id:0,win:void 0}};this.reset=function(){for(var a=[],c=0;c<b.length;c++)(b[c].kind==10||b[c].kind==14)&&a.push(b[c]);for(c in a)d.tryClose(a[c])};this.closeAll=function(){for(var a=[],c=0;c<b.length;c++)b[c].kind==14?a.push(b[c]):b[c].hide();for(c in a)d.tryClose(a[c])}};function GFile(g){var m=this;this.set=0;this.cur=1;this.end=2;this.length=g.length;var j=0;this.bit=0;this.eof=function(){return j>=m.length};this.r8=function(){return g.charCodeAt(j++)&255};this.r16=function(){var d=(g.charCodeAt(j++)&255)<<8;d|=g.charCodeAt(j++)&255;return d};this.r24=function(){var d=(g.charCodeAt(j++)&255)<<16;d|=(g.charCodeAt(j++)&255)<<8;d|=g.charCodeAt(j++)&255;return d};this.r32=function(){var d=(g.charCodeAt(j++)&255)<<24;d|=(g.charCodeAt(j++)&255)<<16;d|=(g.charCodeAt(j++)&
255)<<8;d|=g.charCodeAt(j++)&255;return d};this.peek32=function(){var d=(g.charCodeAt(j)&255)<<24;d|=(g.charCodeAt(j+1)&255)<<16;d|=(g.charCodeAt(j+2)&255)<<8;d|=g.charCodeAt(j+3)&255;return d};this.seek=function(d,b){switch(b){case m.cur:d+=j;break;case m.end:d+=m.length}j=d};this.read=function(d){var b=j;j+=d;return g.substring(b,j)};this.bits=function(d){var b=m.peek32();b>>>=32-m.bit-d;b&=(1<<d)-1;m.bit+=d;m.bit&16&&(m.bit&=15,j+=2);return b}}
function MacFile(g,m,j,d,b,a,c,n){this.parent=g;this.name=m;this.type=j;this.creator=d;this.dataStart=b;this.dataLen=a;this.resStart=c;this.resLen=n}
function FileManager(g){function m(a,b){var d=a+b*512;c.seek(d+8,c.set);var e=c.r8();c.r8();var r=c.r16();switch(e){case 0:for(e=0;e<r;e++){c.seek(d+512-(e+1)*2,c.set);var q=c.r16();c.seek(d+q,c.set);var g=c.r8();c.seek(d+q+g+1,c.set);q=c.r32();m(a,q)}break;case 255:for(e=0;e<r;e++){c.seek(d+512-(e+1)*2,c.set);q=c.r16();g=d+q;c.seek(g,c.set);var l=c.r8();if(l!=0){l++;l&1&&l++;c.r8();q=c.r32();var u=c.r8();u=c.read(u);c.seek(g+l,c.set);switch(c.r16()){case 512:c.seek(g+l+4,c.set);var y=c.r32(),p=c.r32();
c.seek(g+l+20,c.set);var k=c.r32();c.seek(2,c.cur);var A=c.r32();c.seek(6,c.cur);var K=c.r32();c.seek(g+l+74,c.set);var o=c.r16();c.seek(g+l+86,c.set);g=c.r16();j[k]=new MacFile(q,u,y,p,o,A,g,K)}}}break;default:throw"Bad node";}}var j=[],d,b,a,c=void 0;$.ajax({url:g,beforeSend:function(a){a.overrideMimeType("text/html; charset=x-user-defined")},complete:function(n){c=new GFile(n.responseText);c.seek(1044,c.set);d=c.r32();c.seek(1052,c.set);b=c.r16();c.seek(1174,c.set);a=c.r16();n=(a+b)*d;c.seek(n+
d-2,c.set);var f=c.r16();c.seek(n+f+2,c.set);f=c.r32();m(n,f)}});this.isReady=function(){return c!=void 0};this.getResByKind=function(a,f){for(var i=0,e=0,r=0;r<4;r++)i|=a.charCodeAt(r)<<24-r*8,e|=f.charCodeAt(r)<<24-r*8;for(r in j)if(j[r].type==i&&j[r].creator==e)return c.seek((j[r].resStart+b)*d,c.set),new GFile(c.read(j[r].resLen))};this.getRes=function(a){for(var f in j)if(j[f].name==a){if(j[f].resLen==0)break;c.seek((j[f].resStart+b)*d,c.set);return new GFile(c.read(j[f].resLen))}};this.getData=
function(a){for(var f in j)if(j[f].name==a){if(j[f].dataLen==0)break;c.seek((j[f].dataStart+b)*d,c.set);return new GFile(c.read(j[f].dataLen))}};this.neg16=function(a){a&32768&&(a=-((a^65535)+1));return a}};function BitMap(g,m,j){var d=this;this.width=g;this.height=m;this.rowBytes=j;this.data=Array(m*j);this.draw=function(b,a,c){if(!(g==0||m==0)){var n=b.get(0).getContext("2d"),f=g,i=m,e=0,r=0;a<0&&(e=-a,a=0);c<0&&(r=-c,c=0);f+a>=b.width()&&(f=b.width()-a);i+c>=b.height()&&(i=b.height()-c);if(!(f==0||i==0)){b=n.getImageData(a,c,f,i);for(var q=r;q<i;q++)for(var t=q*j,l=(q-r)*b.width*4,u,y=e;y<f;y++)u=(u=d.data[t+(y>>3)]&1<<7-(y&7))?0:255,b.data[l++]=u,b.data[l++]=u,b.data[l++]=u,b.data[l++]=255;n.putImageData(b,
a,c)}}};this.bic=function(b,a,c){if(!(g==0||m==0)){var n=b.get(0).getContext("2d"),f=g,i=m,e=0,r=0;a<0&&(e=-a,a=0);c<0&&(r=-c,c=0);f+a>b.width()&&(f=b.width()-a);i+c>b.height()&&(i=b.height()-c);if(!(f==0||i==0)){b=n.getImageData(a,c,f,i);for(var q=r;q<i;q++)for(var t=q*j,l=(q-r)*b.width*4,u,y=e;y<f;y++)(u=d.data[t+(y>>3)]&1<<7-(y&7))?(b.data[l++]=255,b.data[l++]=255,b.data[l++]=255,b.data[l++]=255):l+=4;n.putImageData(b,a,c)}}};this.or=function(b,a,c){if(!(g==0||m==0)){var n=b.get(0).getContext("2d"),
f=g,i=m,e=0,r=0;a<0&&(e=-a,a=0);c<0&&(r=-c,c=0);f+a>=b.width()&&(f=b.width()-a);i+c>=b.height()&&(i=b.height()-c);if(!(f==0||i==0)){b=n.getImageData(a,c,f,i);for(var q=r;q<i;q++)for(var t=q*j,l=(q-r)*b.width*4,u,y=e;y<f;y++)(u=d.data[t+(y>>3)]&1<<7-(y&7))?(b.data[l++]=0,b.data[l++]=0,b.data[l++]=0,b.data[l++]=255):l+=4;n.putImageData(b,a,c)}}};this.xor=function(b,a,c){if(!(g==0||m==0)){var n=b.get(0).getContext("2d"),f=g,i=m,e=0,r=0;a<0&&(e=-a,a=0);c<0&&(r=-c,c=0);f+a>b.width()&&(f=b.width()-a);i+
c>=b.height()&&(i=b.height()-c);if(!(f==0||i==0)){b=n.getImageData(a,c,f,i);for(var q=r;q<i;q++)for(var t=q*j,l=(q-r)*b.width*4,u,y=e;y<f;y++)(u=d.data[t+(y>>3)]&1<<7-(y&7))?(b.data[l++]^=255,b.data[l++]^=255,b.data[l++]^=255,b.data[l++]=255):l+=4;n.putImageData(b,a,c)}}};this.hit=function(b,a){return(d.data[a*j+(b>>3)]&1<<7-(b&7))!=0};this.intersect=function(b){for(var a=b.top;a<b.top+b.height;a++)for(var c=a*j,n,f=b.left;f<b.left+b.width;f++)if(n=d.data[c+(f>>3)]&1<<7-(f&7))return!0;return!1}}
function decodePack(g){var m=new BitMap(512,302,64),j=Array(72);g.seek(512,g.set);for(var d=0,b=0;b<m.height;b++){for(var a=0;a<72;){var c=g.r8();if(c!=128)if(c&128){c^=255;c+=2;for(var n=g.r8(),f=0;f<c;f++)j[a++]=n}else{c++;for(f=0;f<c;f++)j[a++]=g.r8()}}for(f=0;f<64;f++)m.data[d++]=j[f]}return m}
function decodePPIC(g){var m=g.bits(3),j,d;d=g.bits(1)?g.bits(10):g.bits(6);if((j=g.bits(1)?g.bits(10):g.bits(6))&&d){j=new BitMap(j,d,j+15>>3&65534);switch(m){case 0:decodePPIC0(j,g);break;case 1:decodePPIC1(j,g);break;case 2:decodePPIC2(j,g);break;case 3:decodePPIC3(j,g)}return j}}
function decodePPIC0(g,m){for(var j=g.width>>4,d=g.width&15,b,a=0,c=0;c<g.height;c++){for(var n=0;n<j;n++)b=m.peek32(),m.seek(2,m.cur),b>>>=16-m.bit,g.data[a++]=b>>8&255,g.data[a++]=b&255;d&&(b=m.bits(d),b<<=16-d,g.data[a++]=b>>8&255,g.data[a++]=b&255)}}var ppic1huff=[0,8192,16384,20480,24576,28672,32768,36864,40960,45056,49152,53248,55296,57344,59392,61440,63488],ppic1lens=[3,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5],ppic1values=[0,15,3,5,6,7,8,9,10,12,255,1,2,4,11,13,14];
function decodePPIC1(g,m){decodeHuff(ppic1huff,ppic1lens,ppic1values,g,m)}var ppic2huff=[0,16384,32768,49152,51200,53248,55296,57344,59392,61440,62464,62976,63488,64E3,64512,65024,65280],ppic2lens=[2,2,2,5,5,5,5,5,5,6,7,7,7,7,7,8,8],ppic2values=[255,0,15,1,3,7,14,12,8,6,2,4,9,13,11,10,5];function decodePPIC2(g,m){decodeHuff(ppic2huff,ppic2lens,ppic2values,g,m)}var loadbits=[8,15,2,255,0,4,255,1,7,9,8,255,3,4,255,4,10,7,10,11,6,255,5,6,6,11,255,7,3,255,9,4,3,14,255,12,2,255,13,1,255,15,255];
function decodePPIC3(g,m){for(var j=Array(17),d,b,a=0;(b=loadbits[a++])!=255;){for(d=m.bits(b);(b=loadbits[a++])!=255;)j[loadbits[a++]]=d%b,d=d/b|0;j[loadbits[a++]]=d}j[16]=0;for(d=16;d>0;d--)for(b=d;b<=16;b++)j[b]>=j[d-1]&&j[b]++;for(d=16;d>=0;d--)if(j[d]==16){j[d]=255;break}a=Array(17);var c=Array(17);b=m.bits(2)+1;var n=0;for(d=0;d<15;d++){if(d)for(;!m.bits(1);)b++;c[d]=b;a[d]=n;n+=1<<16-b}for(a[15]=n;n&1<<16-b;)b++;a[16]=n|1<<16-b;c[15]=b;c[16]=b;decodeHuff(a,c,j,g,m)}
function decodeHuff(g,m,j,d,b){var a;walkHuffLast=walkHuffRepeat=0;a=d.width&3?b.bits(5):b.bits(4)<<1;var c=0,n=d.width&15;n&&(n>>=2,c=n&1,n=2-(n>>1));for(var f=0,i=0;i<d.height;i++){for(var e=0;e<d.width>>3;e++){var r=walkHuff(g,m,j,b)<<4;d.data[f++]=walkHuff(g,m,j,b)|r}c&&(d.data[f]=walkHuff(g,m,j,b)<<4);f+=n}if(e=d.width&3){f=d.rowBytes-n;var q=0;for(i=n=0;i<d.height;i++)a&1?(q<e&&(r=walkHuff(g,m,j,b)<<4,n|=r>>>q,q+=4),q-=e,r=n,n<<=e,n&=255):(r=b.bits(e),r<<=8-e),c&&(r>>>=4),d.data[f]|=r&255,f+=
d.rowBytes}if(a&8)for(i=f=0;i<d.height;i++)if(r=0,a&2)for(e=0;e<d.rowBytes;e++)d.data[f]^=r,r=d.data[f++];else for(e=0;e<d.rowBytes;e++)n=d.data[f]^r,n^=n>>>4&15,d.data[f++]=n,r=n<<4;if(a&4){g=d.rowBytes*4;a&2&&(g*=2);f=0;a=g;for(m=0;m<d.height*d.rowBytes-g;m++)d.data[a++]^=d.data[f++]}}var walkHuffRepeat=0,walkHuffLast=0;
function walkHuff(g,m,j,d){if(walkHuffRepeat)return walkHuffRepeat--,walkHuffLast=walkHuffLast<<8&65280|walkHuffLast>>8,walkHuffLast&255;var b=d.peek32();b>>>=16-d.bit;b&=65535;var a;for(a=0;a<16;a++)if(g[a+1]>b)break;d.bit+=m[a];d.bit&16&&(d.bit&=15,d.seek(2,d.cur));g=j[a];if(g==255)return d.bits(1)||(walkHuffLast&=255,walkHuffLast|=walkHuffLast<<8),walkHuffRepeat=d.bits(3),walkHuffRepeat<3&&(walkHuffRepeat<<=4,walkHuffRepeat|=d.bits(4),walkHuffRepeat<8&&(walkHuffRepeat<<=8,walkHuffRepeat|=d.bits(8))),
walkHuffRepeat-=2,walkHuffLast=walkHuffLast<<8&65280|walkHuffLast>>8,walkHuffLast&255;else walkHuffLast<<=8,walkHuffLast|=g,walkHuffLast&=65535;return g}
function GraphicManager(g){function m(d,b,a,c,j,f){d=d.get(0).getContext("2d");for(var i=d.getImageData(b,a,c,j),e=0;e<j;e++)for(var r=e*i.width*4,q=f?0:255,g=0;g<c;g++)i.data[r++]=q,i.data[r++]=q,i.data[r++]=q,i.data[r++]=255;d.putImageData(i,b,a)}var j=this;this.get=function(d){d=g.get(3,d);if(!(d.length<2)){if(d.length==2)return d=(d.charCodeAt(0)&255)<<8|d.charCodeAt(1)&255,j.get(d);return decodePPIC(new GFile(d))}};this.fill=function(d,b){m(d,0,0,d.width(),d.height(),b)};this.draw=function(d,
b,a,c,n){var f={top:0,left:0,width:0,height:0},i;if(i=j.get(d*2+1))switch(f={top:a,left:b,width:i.width,height:i.height},n){case 1:i.bic(c,b,a);break;case 2:i.or(c,b,a)}else if(i=j.get(d*2))switch(f={top:a,left:b,width:i.width,height:i.height},n){case 1:m(c,b,a,i.width,i.height,0);break;case 2:m(c,b,a,i.width,i.height,1)}n>0&&(i=j.get(d*2))&&i.xor(c,b,a);return f};this.sectRect=function(d,b,a){var c=b.top,j=b.left,f=j+b.width;b=c+b.height;if(c<d.top)c=d.top;if(j<d.left)j=d.left;b>d.top+d.height&&
(b=d.top+d.height);f>d.left+d.width&&(f=d.left+d.width);if(f<=j||b<=c)c=b=j=f=0;a.top=c;a.left=j;a.width=f-j;a.height=b-c;return a.height!=0}};function ObjectManager(g){var m=[];this.load=function(j,d){var b=g.getData(d),a={};a.numitems=0;a.isobj=!1;b.seek(0,b.set);var c=b.length,n=b.r32(),f;if(n&2147483648){n&=2147483647;a.isobj=!0;b.seek(n,b.set);a.numitems=b.r16();c=Array(16);for(var i=Array(16),e=0;e<15;e++)c[e]=b.r16();for(e=0;e<16;e++)i[e]=b.r8();a.offsets=Array(a.numitems);a.lengths=Array(a.numitems);var r=0;for(e=0;e<a.numitems;e++){if((e&63)==0){b.seek(n+(e>>6)*6+48,b.set);var q=b.r24();f=b.r24();r=q&7;b.seek(n+(q>>3),b.set)}a.offsets[e]=
f;q=b.r32()>>>16-r&65535;b.seek(-4,b.cur);var t;for(t=0;t<16;t++)if(c[t]>q)break;q=i[t];r+=q&15;r&16&&(r&=15,b.seek(2,b.cur));q>>=4;t=0;q&&(t=b.peek32(),q--,q==0?t=0:t>>>=32-q-r,t&=(1<<q)-1,t|=1<<q,r+=q,r&16&&(r&=15,b.seek(2,b.cur)),f+=t);a.lengths[e]=t}f=n-4}else c-=4,f=c,a.itemlen=n,a.numitems=c/n|0;b.seek(4,b.set);a.data=b.read(f);m[j]=a};this.get=function(j,d){if(d>=m[j].numitems)return"";var b,a;m[j].isobj?(b=m[j].lengths[d],a=m[j].offsets[d]):(b=m[j].itemlen,a=d*b);if(!b)return"";return m[j].data.substring(a,
a+b)}};function TextManager(g,m){function j(b){if(b&32768)return a.input;b=new GFile(g.get(2,b));for(var c=!1,f="",n=b.r16();n--;){var i=b.bits(5);if(i>0&&i<27)i|=64,c&&(i|=32),c=!0,f+=String.fromCharCode(i);else switch(i){case 0:f+=" ";break;case 27:f+=c?".":",";c=!0;break;case 28:f+=c?"'":'"';c=!0;break;case 29:c=b.bits(16);c&32768?(c^=65535,c=d(c)):c=j(c);c&&(f+=c);c=!0;break;case 30:f+=String.fromCharCode(b.bits(8));c=!0;break;case 31:c=!c}}return webventure.mac2ascii(f)}function d(c){var d,f;d=c&8?
a.target:a.source;if((c&3)==1)d=webventure.get(d,7),f=m.getIndStr(132,(d>>4&3)+1);else{f=a.get(d);if(f=="")throw"String error";switch(c&3){case 2:f=b(0,d)+f;break;case 3:f=b(2,d)+f}}f.length&&c&4&&(f=a.capitalize(f));return f}function b(a,b){var c=webventure.get(b,7)>>a&3;if(c)return m.getIndStr(131,c);return""}var a=this,c,n,f,i=!0;this.input="";this.setHuff=function(a){if(a!=void 0){i=!1;var b=a.r16();a.r16();c=Array(b);for(var d=0;d<b-1;d++)c[d]=a.r16();n=Array(b);for(d=0;d<b;d++)n[d]=a.r8();f=
Array(b);for(d=0;d<b;d++)f[d]=a.r8()}};this.get=function(b){if(i)return j(b);if(b&32768)return a.input;b=new GFile(g.get(2,b));var r,m="";for(r=b.bits(1)?b.bits(15):b.bits(7);r--;){var t=b.peek32();t>>=16-b.bit;t&=65535;var l;for(l=0;l<c.length;l++)if(t<c[l])break;b.bit+=n[l];b.bit&16&&(b.bit&=15,b.seek(2,b.cur));t=f[l];t==1&&(t=b.bits(7));t!=2?m+=String.fromCharCode(t):(b.bits(1)?(t=b.bits(15),t=a.get(t)):(t=b.bits(8),t=d(t)),t&&(m+=t))}return webventure.mac2ascii(m)};this.capitalize=function(a){return a.substr(0,
1).toUpperCase()+a.substr(1)}};function EngineState(){function g(d){d<0&&(d=(-d^65535)+1);return d}var m=Array(128),j=128;this.push=function(d){j--;m[j]=g(d)&65535};this.pop=function(){return m[j++]};this.peek=function(d){return m[j+d]};this.poke=function(d,b){m[j+d]=g(b)&65535};this.clear=function(){j=128};this.size=function(){return 128-j}}
function Engine(g,m,j,d){function b(b){b=typeof b!="undefined"?b:!1;var e=!1;if(l[0].haltedInFirst||b){l[0].haltedInFirst=!1;if(e=b?a(0):c())return l[0].haltedInFirst=!0;e=!0;l[0].familyIdx=0}if(l[0].haltedInFamily||e){l[0].haltedInFamily=!1;var d=webventure.getFamily(webventure.get(1,0),!1);for(b=l[0].familyIdx;b<d.length;b++){if(e=e?a(d[b]):c())return l[0].haltedInFamily=!0,l[0].familyIdx=b,!0;e=!0}}var f;if(l[0].haltedInSaves&&(l[0].haltedInSaves=!1,c()))return l[0].haltedInSaves=!0;do{for(b=e=
0;b<l[0].saves.length;b++)if(e<l[0].saves[b].rank)e=l[0].saves[b].rank,f=b;if(e&&(l[0].saves[f].rank=0,a(l[0].saves[f].func)))return l[0].haltedInSaves=!0}while(e);l.shift();return!1}function a(a){if(a=g.get(1,a))return l[0].p[0]=new GFile(a),i();return!1}function c(){var a=i();if(a)return a;l[0].p.shift();if(l[0].p.length)return c()}function n(a){a&128&&(a=-((a^255)+1));return a}function f(a){a&32768&&(a=-((a^65535)+1));return a}function i(){for(var c=l[0].p[0],d=l[0].state;!c.eof();){var k=c.r8();
if(k&128)switch(k){case 128:var i=d.pop(),g=d.pop();k=webventure.get(i,g);d.push(k);break;case 129:i=d.pop();g=d.pop();k=f(d.pop());webventure.set(i,g,k);break;case 130:i=d.pop();g=d.pop();k=d.pop();d.push(r(i,g,k!=0));break;case 131:d.push(l[0].curCtl);break;case 132:d.push(l[0].curObj);break;case 133:d.push(l[0].target);break;case 134:d.push(l[0].ptx);break;case 135:d.push(l[0].pty);break;case 136:d.push(c.r8());break;case 137:d.push(c.r16());break;case 138:i=d.pop();d.push(webventure.globals[i]);
break;case 139:i=d.pop();k=f(d.pop());webventure.globals[i]=k;webventure.gameChanged=!0;break;case 140:k=d.pop();d.push(Math.round((k-1)*Math.random()));break;case 141:k=d.peek(0);d.push(k);break;case 142:i=d.pop();for(g=i-1;i--;)k=d.peek(g),d.push(k);break;case 143:g=d.pop();var o=d.pop();d.push(g);d.push(o);break;case 144:i=d.pop();o=d.peek(i);g=d.peek(0);d.poke(i,g);d.poke(0,o);break;case 145:d.pop();break;case 146:k=d.peek(1);d.push(k);break;case 147:i=d.pop();k=d.peek(i);d.push(k);break;case 148:o=
d.pop();g=d.pop();k=d.pop();d.push(o);d.push(k);d.push(g);break;case 149:var t=f(d.pop());i=f(d.pop());t%=i;t<0&&(t+=i);var F=0,Q=0;for(k=1;k<i;k++)Q+=t,Q>=i&&(Q-=i),Q==F?(F++,Q=F):(o=d.peek(F),g=d.peek(Q),d.poke(F,g),d.poke(Q,o));break;case 150:d.clear();break;case 151:d.push(d.size());break;case 152:g=d.pop();o=d.pop();d.push(o+g);break;case 153:g=d.pop();o=d.pop();d.push(o-g);break;case 154:g=d.pop();o=d.pop();d.push(o*g);break;case 155:g=d.pop();o=d.pop();d.push(o/g|0);break;case 156:g=d.pop();
o=d.pop();d.push(o%g);break;case 157:g=d.pop();o=d.pop();d.push(o%g);d.push(o/g|0);break;case 158:k=f(d.pop());k<0&&(k=-k);d.push(k);break;case 159:k=-f(d.pop());d.push(k);break;case 160:g=d.pop();o=d.pop();d.push(o&g);break;case 161:g=d.pop();o=d.pop();d.push(o|g);break;case 162:g=d.pop();o=d.pop();d.push(o^g);break;case 163:k=d.pop();d.push(k^65535);break;case 164:g=d.pop();o=d.pop();d.push(o&&g?65535:0);break;case 165:g=d.pop();o=d.pop();d.push(o||g?65535:0);break;case 166:g=d.pop();o=d.pop();
d.push(!o!=!g?65535:0);break;case 167:k=d.pop();d.push(k==0?65535:0);break;case 168:g=d.pop();o=d.pop();d.push(o>g?65535:0);break;case 169:g=d.pop();o=d.pop();d.push(o<g?65535:0);break;case 170:g=f(d.pop());o=f(d.pop());d.push(o>g?65535:0);break;case 171:g=f(d.pop());o=f(d.pop());d.push(o<g?65535:0);break;case 172:g=d.pop();o=d.pop();d.push(o==g?65535:0);break;case 173:g=m.get(d.pop());o=m.get(d.pop());d.push(o==g?1:0);break;case 174:k=m.get(d.pop());i=m.get(d.pop());d.push(i.toLowerCase().indexOf(k.toLowerCase())!=
-1?1:0);break;case 175:k=m.get(d.pop());i=m.get(d.pop());d.push(RegExp("\\b"+k+"\\b","i").test(i)?65535:0);break;case 176:k=f(c.r16());c.seek(k,c.cur);break;case 177:k=n(c.r8());c.seek(k,c.cur);break;case 178:k=f(c.r16());g=d.pop();g!=0&&c.seek(k,c.cur);break;case 179:k=n(c.r8());g=d.pop();g!=0&&c.seek(k,c.cur);break;case 180:k=f(c.r16());g=d.pop();g==0&&c.seek(k,c.cur);break;case 181:k=n(c.r8());g=d.pop();g==0&&c.seek(k,c.cur);break;case 182:k=d.pop();i=d.pop();l[0].saves.push({rank:k,func:i});break;
case 183:i=d.pop();for(k=0;k<l[0].saves.length;k++)if(l[0].saves[k].func==i)l[0].saves[k].rank=0;break;case 184:i=d.pop();for(k=0;k<l[0].saves.length;k++)if(l[0].saves[k].rank<=i)l[0].saves[k].rank=0;break;case 185:g=d.pop();for(k=0;k<l[0].saves.length;k++)if(l[0].saves[k].rank>=g)l[0].saves[k].rank=0;break;case 186:i=d.pop();g=d.pop();for(k=0;k<l[0].saves.length;k++)if(l[0].saves[k].rank>=g&&l[0].saves[k].rank<=i)l[0].saves[k].rank=0;break;case 187:k=d.pop();i=d.pop();g=d.pop();o=d.pop();t=d.pop();
l.unshift({curCtl:k,curObj:i,target:g,ptx:o,pty:t,state:new EngineState,saves:[],p:[void 0]});if(b(!0))return!0;break;case 188:k=d.pop();l[0].p.unshift(void 0);if(a(k))return!0;l[0].p.shift();c=l[0].p[0];break;case 189:i=d.pop();webventure.queue.push({id:2,val:i});break;case 190:k={};k.from=d.pop();k.to=d.pop();webventure.queue.push({id:8,val:k});webventure.set(k.to,6,webventure.get(k.from,6));webventure.set(k.from,6,0);i=webventure.getFamily(k.from,!0);for(g=1;g<i.length;g++)webventure.set(i[g],
0,k.to);break;case 191:webventure.queue.push({id:14,val:l[0].curObj});break;case 192:webventure.queue.push({id:13});break;case 193:k=d.pop();webventure.textQueue.push({id:3,val:[l[0].target,l[0].curObj,k]});break;case 194:webventure.textQueue.push({id:2});break;case 195:k=d.pop();webventure.textQueue.push({id:3,val:[l[0].target,l[0].curObj,k]});webventure.textQueue.push({id:2});break;case 196:webventure.textQueue.push({id:2});k=d.pop();webventure.textQueue.push({id:3,val:[l[0].target,l[0].curObj,
k]});webventure.textQueue.push({id:2});break;case 197:k=d.pop();webventure.textQueue.push({id:1,val:k});break;case 198:d.push(2);break;case 199:i=d.pop();webventure.soundQueue.push({id:1,val:i});break;case 200:i=d.pop();webventure.soundQueue.push({id:2,val:i});break;case 201:webventure.soundQueue.push({id:3});break;case 202:k=new Date;k=[k.getFullYear(),k.getMonth()+1,k.getDate(),k.getHours(),k.getMinutes(),k.getSeconds()];d.push(k[0]);d.push(k[1]);d.push(k[2]);d.push(k[3]);d.push(k[4]);d.push(k[5]);
break;case 203:d.push((new Date).getDay()+1);break;case 204:k=d.pop();i=d.pop();i=webventure.getFamily(i,k!=0);for(k=1;k<i.length;k++)d.push(i[k]);d.push(i.length-1);break;case 205:k=d.pop();i=d.pop();i=webventure.getFamily(i,k!=0);d.push(i.length-1);break;case 206:d.push(86);break;case 207:k=j.getIndStr(129,1);d.push(k.charCodeAt(3)-48);break;case 208:d.push(1);break;case 209:i=d.pop();k=e(i);k={v:k.height,h:k.width};d.push(k.h);d.push(k.v);break;case 210:g=d.pop();o=d.pop();d.push(q(g,o));break;
case 211:k=i=d.pop();i=[];g=webventure.getFamily(webventure.get(k,0),1);for(o=1;o<g.length;o++)k<g[o]&&q(g[o],k)>=40&&i.push(g[o]);for(;i.length;)webventure.set(i.pop(),0,k);break;case 212:i=d.pop();k=webventure.getFamily(i,1);i=webventure.get(i,0);for(g=1;g<k.length;g++)webventure.set(k[g],0,i);break;case 213:return c=d.pop(),webventure.textEntry(c,l[0].curObj,l[0].target),!0;case 214:webventure.activateCommand(d.pop());break;case 215:webventure.gameState=3;break;case 216:webventure.gameState=2;
break;case 217:return c=d.pop(),setTimeout(webventure.runMain,c/60*1E3),!0;case 218:return webventure.updateScreen(!1),webventure.clickToContinue(),!0;case 219:webventure.runQueue();break;case 220:if(webventure.playSounds(!0))return!0;break;case 221:webventure.printTexts();break;case 222:if(webventure.updateScreen(!0))return!0;break;case 223:return c=d.pop(),webventure.invertmain(),setTimeout(webventure.revertmain,c/60*1E3),!0;case 224:d.pop();break;case 225:d.pop();break;case 226:g=d.pop();o=d.pop();
o*=g;k=d.pop();o/=k;d.push(o|0);break;case 227:i=d.pop();webventure.updateObject(i);break;case 228:d.push(0);break;case 229:break;case 230:d.push(u);break;case 231:i=d.pop();g=1;for(k=u=0;k<i;k++)u+=g,u^=g,g^=u,u^=g;break;default:throw"func: "+k.toString(16);}else d.push(k)}return!1}function e(a){var b={top:0,left:0,width:0,height:0},c=webventure.getParentWin(a),e=0;c&&c.refCon&&(e=webventure.getChildIdx(c.refCon.children,a));if(e){if(c.refCon.children[e-1].width==0||c.refCon.children[e-1].height==
0)a=webventure.drawObject(a,c,!0),c.refCon.children[e-1].top=a.top,c.refCon.children[e-1].left=a.left,c.refCon.children[e-1].width=a.width,c.refCon.children[e-1].height=a.height;b.top=c.refCon.children[e-1].top;b.left=c.refCon.children[e-1].left;b.width=c.refCon.children[e-1].width;b.height=c.refCon.children[e-1].height}else(c=d.get(a*2))!=void 0?(b.top=webventure.get(a,2),b.left=webventure.get(a,1),b.width=c.width,b.height=c.height):(c=d.get(a*2+1))!=null?(b.top=webventure.get(a,2),b.left=webventure.get(a,
1),b.width=c.width,b.height=c.height):(b.top=0,b.left=0,b.width=0,b.height=0);return b}function r(a,b,c){var d=0;a=webventure.getFamily(a,c);for(c=1;c<a.length;c++)d+=webventure.get(a[c],b);return d}function q(a,b){if(webventure.get(a,0)!=webventure.get(b,0))return 0;var c=e(a),f=e(b);if(d.sectRect(f,c,f))return f.width*f.height*100/(c.width*c.height)|0;return 0}var t=this,l=[];this.reset=function(){l=[]};this.push=function(a){l[0].state.push(a)};this.run=function(a,b,c,d){l.unshift({curCtl:a,curObj:b,
target:c,ptx:d.h,pty:d.v,state:new EngineState,saves:[],p:[]});return t.resume(!0)};this.resume=function(a){for(a=typeof a!="undefined"?a:!1;l.length;)if(b(a))return!0;return!1};var u=0};function ResourceManager(){var g=this,m=[];this.open=function(g){m.push(g);return m.length-1};this.close=function(g){m.splice(g,1)};this.get=function(g,d){for(var b=g.charCodeAt(0)<<24|g.charCodeAt(1)<<16|g.charCodeAt(2)<<8|g.charCodeAt(3),a=m.length-1;a>=0;a--){var c=m[a];c.seek(0,c.set);var n=c.r32(),f=c.r32();c.seek(f+24,c.set);f+=c.r16();c.seek(f,c.set);for(var i=c.r16()+1,e=0;e<i;e++){if(c.r32()==b){b=c.r16()+1;c.seek(f+c.r16(),c.set);for(e=0;e<b;e++){if(c.r16()==d)return c.seek(2,c.cur),n+=
c.r32()&16777215,c.seek(n,c.set),n=c.r32(),new GFile(c.read(n));c.seek(10,c.cur)}return}c.seek(4,c.cur)}}};this.getString=function(j){j=g.get("STR ",j);if(j==void 0)return"";var d=j.r8();return j.read(d)};this.getIndStr=function(j,d){if(d==0)return"";var b=g.get("STR#",j);if(b==void 0)return"";var a=b.r16();if(d>a)return"";for(;;){d--;if(d==0)return a=b.r8(),b.read(a);a=b.r8();b.seek(a,b.cur)}}};function ControlManager(){function g(b,a,c,d,f,i,e){var g=$(document.createElement("div"));g.addClass("button");g.css("top",a+"px");g.css("left",b+"px");g.css("width",c-2+"px");g.css("height",d-2+"px");g.css("line-height",d-2+"px");g.html(f);g.data("refcon",e);i==!1&&g.hide();g.mousedown(function(a){webventure.buttonClicked(g,a);return!1});return g}function m(b,a,c,d,f,g,e){var j=$(document.createElement("div"));j.addClass("cbutton");j.css("top",a+"px");j.css("left",b+"px");j.css("width",c-2+"px");
j.css("height",d-2+"px");j.html(f);j.data("refcon",e);g==!1&&j.hide();j.mousedown(function(a){webventure.buttonClicked(j,a);return!1});return j}function j(b,a,c,d,f,g,e,j,m){var t=$(document.createElement("div"));t.addClass("hslider");t.css("top",a+"px");t.css("left",b+"px");t.css("width",c+"px");t.css("height",d+"px");t.data("refcon",m);j==!1&&t.hide();b=$(document.createElement("div"));b.addClass("hsliderLeft");b.css("top","0px");b.css("left","0px");t.append(b);b=$(document.createElement("div"));
b.addClass("hsliderWell");b.css("top","0px");b.css("left","4px");b.css("width",c-8+"px");t.append(b);a=$(document.createElement("div"));a.addClass("hsliderRight");a.css("top","0px");a.css("left",c-4+"px");t.append(a);var l=$(document.createElement("div"));l.addClass("hsliderThumb");l.css("top","-4px");l.css("left",((f-g)*(c-8-11)/e|0)+"px");b.append(l);t.data("value",f);l.mousedown(function(a){var b=a.pageX,d=l.position().left;$(document).mousemove(function(a){d+=a.pageX-b;b=a.pageX;d>=0&&d<=c-8-
11?l.css("left",d+"px"):d<0?l.css("left","0px"):l.css("left",c-8-11+"px");return!1});$(document).mouseup(function(){$(document).unbind("mousemove");$(document).unbind("mouseup");var a=l.position().left;t.data("value",g+(a*(e-g)/(c-8-11)|0));return!1});return!1});return t}var d=this;this.create=function(b,a,c,d,f,i,e,r,q,t,l){switch(f>>4){case 0:return g(b,a,c,d,i,e,l);case 128:return m(b,a,c,d,i,e,l);case 256:return f=$(document.createElement("input")),f.addClass("textinput"),f.css("top",a+"px"),
f.css("left",b+"px"),f.css("width",c+"px"),f.css("height",d+"px"),f.val(i),f.data("refcon",l),e==!1&&f.hide(),f;case 272:return f=$(document.createElement("div")),f.addClass("text"),f.css("top",a+"px"),f.css("left",b+"px"),f.css("width",c+"px"),f.css("height",d+"px"),f.html(i),f.data("refcon",l),e==!1&&f.hide(),f;case 288:return i=$(document.createElement("div")),i.addClass("list"),i.css("top",a+"px"),i.css("left",b+"px"),i.css("width",c+"px"),i.css("height",d+"px"),i.data("refcon",l),e==!1&&i.hide(),
i;case 304:return j(b,a,c,d,r,q,t,e,l);default:throw"Unknown CDEF:"+f;}};this.get=function(b){var a=b.r16(),c=b.r16(),g=b.r16()-a,f=b.r16()-c,i=b.r16(),e=b.r8()!=0;b.r8();var j=b.r16(),m=b.r16(),t=b.r16(),l=b.r32(),u=b.r8(),y="";u!=0&&(y=b.read(u));return d.create(c,a,f,g,t,y,e,i,m,j,l)};this.move=function(b,a,c){var d=b.position();b.css("left",d.left+a+"px");b.css("top",d.top+c+"px")}};function Sound(g,m){function j(){var a=Array(44+g);a[0]=82;a[1]=73;a[2]=70;a[3]=70;var c=36+g;a[4]=c&255;a[5]=c>>8&255;a[6]=c>>16&255;a[7]=c>>24&255;a[8]=87;a[9]=65;a[10]=86;a[11]=69;a[12]=102;a[13]=109;a[14]=116;a[15]=32;a[16]=16;a[17]=0;a[18]=0;a[19]=0;a[20]=1;a[21]=0;a[22]=1;a[23]=0;a[24]=m&255;a[25]=m>>8&255;a[26]=m>>16&255;a[27]=m>>24&255;a[28]=a[24];a[29]=a[25];a[30]=a[26];a[31]=a[27];a[32]=1;a[33]=0;a[34]=8;a[35]=0;a[36]=100;a[37]=97;a[38]=116;a[39]=97;a[40]=g&255;a[41]=g>>8&255;a[42]=g>>16&
255;a[43]=g>>24&255;for(c=0;c<g;c++)a[44+c]=d.data[c];c="";var j,f,i="",e,r;f="";var q=0;do j=a[q++],f=a[q++],i=a[q++],e=j>>2,j=(j&3)<<4,f==void 0?r=f=64:i==void 0?(j|=f>>4,f=64):(j|=f>>4,r=(f&15)<<2|i>>6,f=i&63),c+=b.charAt(e)+b.charAt(j)+b.charAt(r)+b.charAt(f);while(q<a.length);return c}var d=this,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.data=Array(g);this.time=function(){return g/m};this.play=function(){var a=$(document.createElement("audio"));$(document.body).append(a);
a.attr("src","data:audio/x-wav;base64,"+j());var b=webventure.setting("volume");b==null&&(b=50);a.attr("volume",b/100);a.bind("ended",function(){a.remove()});a.get(0).play()}}
function SoundManager(g){var m=this,j=!1;try{var d=document.createElement("audio").canPlayType("audio/wav");j=d!=""&&d!="no"}catch(b){}this.muted=!1;this.play=function(a){var b=g.get(4,a);a=new GFile(b);var d=void 0;switch(b.charCodeAt(5)&255){case 16:var f=[];a.seek(408,a.set);for(var i=0;i<16;i++)f[i]=a.r8();var e=a.r32()*2;a.r16();i=a.r32()*22100/65536|0;var r=new Sound(e,i),q;for(i=0;i<e;i++)i&1?q>>=4:q=a.r8(),r.data[i]=f[q&15];d=r;break;case 18:a.seek(12,a.set);f=a.r16();a.seek(52,a.set);q=a.r16()+
52;a.seek(q,a.set);e=a.r32()-6;a.r16();i=a.r32()*22100/65536|0;i=new Sound(e*f,i);r=0;b=a.seek(226,a.set)+226;for(d=0;d<f;d++){a.seek(b+d*2,a.set);var t=a.r16();a.seek(q+10,a.set);for(var l=0;l<e;l++){var u=a.r8();u&128?(u-=128,u*=t,u=u>>8&255,u&128&&(u=127),u+=128):(u=(u^255)+1,u-=128,u*=t,u=u>>8&255,u&128&&(u=127),u+=128,u=(u^255)+1);i.data[r++]=u}}d=i;break;case 24:f=[];a.seek(594,a.set);for(i=0;i<16;i++)f[i]=a.r8();q=a.r32()*2;a.r16();i=a.r32()*22100/65536|0;r=new Sound(q,i);for(i=0;i<q;i++)i&
1?e>>=4:e=a.r8(),r.data[i]=f[e&15];d=r;break;case 26:f=[];a.seek(544,a.set);for(e=0;e<16;e++)f[e]=a.r8();q=a.r32();a.r16();e=a.r32()*22100/65536|0;r=new Sound(q,e);for(e=0;e<q;e++)e&1?i>>=4:i=a.r8(),r.data[e]=f[i&15];d=r;break;case 68:a.seek(94,a.set);f=a.r32();q=a.r32()*22100/65536|0;q=new Sound(f,q);for(e=0;e<f;e++)q.data[e]=a.r8();d=q;break;case 120:f=[];a.seek(186,a.set);for(e=0;e<16;e++)f[e]=a.r8();a.r32();q=a.r32();e=a.r32()*22100/65536|0;i=new Sound(q,e);for(e=0;e<q;e++)e&1?r<<=4:r=a.r8(),
i.data[e]=f[r>>4&15];d=i;break;case 126:q=[];a.seek(194,a.set);for(i=0;i<16;i++)q[i]=a.r8();a.r32();e=a.r32();i=a.r32()*22100/65536|0;r=new Sound(e,i);b=128;for(i=0;i<e;i++)i&1?f<<=4:f=a.r8(),b+=q[f>>4&15],r.data[i]=b&255;d=r}return d==void 0?0:(j&&!m.muted&&d.play(),d.time())}};function Menu(g,m){var j=this;this.id=g;this.title=m;this.el=void 0;var d=[];this.add=function(b){d.push(b)};this.draw=function(){var b=$(document.createElement("table"));b.addClass("menu");var a=$(document.createElement("tbody"));b.append(a);var c=j.el.position();b.css("top",c.top+19+"px");b.css("left",c.left+"px");for(c=0;c<d.length;c++){var g=d[c].draw();a.append(g)}return b}}
function MenuItem(g,m){this.draw=function(){var j=$(document.createElement("tr"));if(g=="-"){var d=$(document.createElement("td"));d.attr("colspan","2");d.addClass("divider");d.append(document.createElement("hr"))}else j.addClass("menuitem"),d=$(document.createElement("td")),d.html(g),j.append(d),d=$(document.createElement("td")),m!=0&&(d.addClass("shortcut"),d.append(String.fromCharCode(m)));j.append(d);return j}}
function MenuManager(g){function m(b){if(!webventure.isPaused){for(var a,c=0,n=$(b.target);n.data("refCon")==void 0;)n=n.parent();n.addClass("active");b=n.data("refCon");for(a=0;a<j.length;a++)if(j[a].id==b)break;var f=j[a].draw();g.append(f);$(document).mousemove(function(b){var e=d.position();if(b.pageX>=e.left&&b.pageY>e.top&&b.pageX<e.left+d.width()&&b.pageY<e.top+d.height())for(a=0;a<j.length;a++){e=j[a].el.position();var m=(j[a].el.outerWidth()-j[a].el.width())/2;if(b.pageX>=e.left-m&&b.pageX<
e.left-m+j[a].el.outerWidth()){f.remove();n.removeClass("active");n=j[a].el;n.addClass("active");f=j[a].draw();g.append(f);break}}else e=f.position(),b.pageX>=e.left&&b.pageY>=e.top&&b.pageX<e.left+f.width()&&b.pageY<e.top+f.height()?(b.pageY-=e.top,f.find("tr").each(function(a,d){e=$(d).position();b.pageY>=e.top&&b.pageY<e.top+$(d).height()?$(d).hasClass("menuitem")&&(c=a+1,$(d).addClass("active")):$(d).removeClass("active")})):(f.find("tr").each(function(a,b){$(b).removeClass("active")}),c=0)});
$(document).mouseup(function(){$(document).unbind("mousemove");$(document).unbind("mouseup");f.remove();n.removeClass("active");c&&webventure.menuSelect(j[a].id,c)})}}var j=[],d;this.get=function(b){var a=b.r16();b.seek(12,b.cur);var c=b.r8(),d="";c!=0&&(d=b.read(c));c==1&&(d="");for(a=new Menu(a,d);;){d=b.r8();if(d==0)break;c="";d!=0&&(c=webventure.mac2ascii(b.read(d)));b.r8();d=b.r8();var f=b.r8(),g=b.r8();c=new MenuItem(c,d,f,g);a.add(c)}j.push(a)};this.show=function(){d=$(document.createElement("div"));
d.addClass("menubar");for(var b in j){var a=$(document.createElement("div"));a.addClass("menu");j[b].title==""?a.addClass("apple"):a.append(j[b].title);a.data("refCon",j[b].id);a.mousedown(function(a){m(a);return!1});j[b].el=a;d.append(a)}g.append(d)};this.addDA=function(b){j[0].add(new MenuItem(b,0,0,0))}};webventure.init();
